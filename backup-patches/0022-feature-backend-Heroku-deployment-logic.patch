From 24eeac8a5e39f5266dd53e170b62022f03f7750a Mon Sep 17 00:00:00 2001
From: Robbie <rgbenn27@colby.edu>
Date: Mon, 17 Nov 2025 20:18:53 -0500
Subject: [PATCH 22/26] feature(backend): Heroku deployment logic

---
 api/app.py           | 26 ++++++++++++++++++++------
 api/requirements.txt |  4 +++-
 procfile             |  1 +
 3 files changed, 24 insertions(+), 7 deletions(-)
 create mode 100644 procfile

diff --git a/api/app.py b/api/app.py
index 44d3aa7..22e88a7 100644
--- a/api/app.py
+++ b/api/app.py
@@ -32,8 +32,15 @@ os.makedirs(instance_path, exist_ok=True)
 # Flask App Setup
 # -----------------------------
 app = Flask(__name__, instance_path=instance_path)
+
+allowed_origins = [
+    'http://localhost:5173',
+    'http://127.0.0.1:5173',
+    os.environ.get('FRONTEND_URL', '')
+]
+
 CORS(app,
-     origins=['http://localhost:5173', 'http://127.0.0.1:5173'],
+     origins=allowed_origins,
      supports_credentials=True,
      allow_headers=['Content-Type', 'Authorization', 'X-Requested-With', 'Accept'],
      methods=['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'PATCH'],
@@ -41,12 +48,19 @@ CORS(app,
      always_send=True)
 
 # Configuration
-app.config['SECRET_KEY'] = 'your-secret-key-change-this-in-production'
-db_path = os.path.join(instance_path, 'syntest.db')
-app.config['SQLALCHEMY_DATABASE_URI'] = f'sqlite:///{db_path}'
+app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY', 'your-secret-key-change-this-in-production')
+
+database_url = os.environ.get('DATABASE_URL')
+if database_url:
+    database_url = database_url.replace("postgres://", "postgresql://", 1)
+    app.config['SQLALCHEMY_DATABASE_URI'] = database_url
+else:
+    db_path = os.path.join(instance_path, 'syntest.db')
+    app.config['SQLALCHEMY_DATABASE_URI'] = f'sqlite:///{db_path}'
+
 app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
 app.config['SESSION_COOKIE_HTTPONLY'] = True
-app.config['SESSION_COOKIE_DOMAIN'] = None  # for localhost
+app.config['SESSION_COOKIE_DOMAIN'] = None
 
 # Initialize database
 db.init_app(app)
@@ -234,4 +248,4 @@ def index():
 # RUN DEVELOPMENT SERVER
 # =====================================
 if __name__ == '__main__':
-    app.run(debug=True)
+    app.run(debug=True)
\ No newline at end of file
diff --git a/api/requirements.txt b/api/requirements.txt
index d1826b7..7815718 100644
--- a/api/requirements.txt
+++ b/api/requirements.txt
@@ -2,4 +2,6 @@ Flask==2.3.3
 Flask-SQLAlchemy==3.0.5
 Flask-CORS==4.0.0
 Werkzeug==2.3.7
-SQLAlchemy==2.0.20
\ No newline at end of file
+SQLAlchemy==2.0.20
+gunicorn==21.2.0
+psycopg2-binary==2.9.9
\ No newline at end of file
diff --git a/procfile b/procfile
new file mode 100644
index 0000000..ded8440
--- /dev/null
+++ b/procfile
@@ -0,0 +1 @@
+web: gunicorn --chdir api/ app:app
\ No newline at end of file
-- 
2.46.1

