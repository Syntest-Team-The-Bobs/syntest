From e8bb35e017dcb37b69caaed4331296019eba66b4 Mon Sep 17 00:00:00 2001
From: Robbie <rgbenn27@colby.edu>
Date: Thu, 13 Nov 2025 23:56:44 -0500
Subject: [PATCH 07/26] feat: integrate MusicPlayer into TestLayout (#52)

---
 src/components/trigger_color/TestLayout.jsx | 70 ++++++++++++++++-----
 1 file changed, 53 insertions(+), 17 deletions(-)

diff --git a/src/components/trigger_color/TestLayout.jsx b/src/components/trigger_color/TestLayout.jsx
index f1aaf11..35ed64a 100644
--- a/src/components/trigger_color/TestLayout.jsx
+++ b/src/components/trigger_color/TestLayout.jsx
@@ -1,10 +1,11 @@
-import React from 'react';
+import React, { useState } from 'react';
 import TestProgress from './TestProgress';
 import TestInstructions from './TestInstructions';
 import ColorWheel from './ColorWheel';
 import StimulusDisplay from './StimulusDisplay';
 import ColorPreviewLock from './ColorPreviewLock';
 import ProgressBar from '../ui/ProgressBar';
+import MusicPlayer from './MusicPlayer';
 
 /**
  * TestLayout - Main UI layout for color synesthesia test interface
@@ -13,6 +14,17 @@ import ProgressBar from '../ui/ProgressBar';
  * - Orchestrates layout of all test UI components in a 3-column grid
  * - Displays title, instructions, and progress information
  * - Manages visual hierarchy and spacing of test elements
+ * - Conditionally renders MusicPlayer for music tests or StimulusDisplay for other tests
+ * - Disables Next button during audio playback (music tests only)
+ * 
+ * Layout Structure:
+ * - Header: Title and instructions
+ * - Progress: Test phase and trial information
+ * - 3-Column Grid:
+ *   - Left: Instructions panel
+ *   - Center: Color wheel
+ *   - Right: Stimulus display (music player or text) + color preview + Next button
+ * - Footer: Overall progress bar
  */
 export default function TestLayout({
   title,
@@ -31,9 +43,13 @@ export default function TestLayout({
   onNext,
   getFontSize
 }) {
+  // Track music playing state to disable Next button during playback
+  const [isMusicPlaying, setIsMusicPlaying] = useState(false);
+
   return (
     <div style={{ minHeight: "100vh", backgroundColor: "#f9fafb" }}>
       <div style={{ maxWidth: "1200px", margin: "0 auto", padding: "3rem 2rem" }}>
+        
         {/* Page title */}
         <h1 style={{ 
           fontSize: "2.25rem", 
@@ -45,7 +61,7 @@ export default function TestLayout({
           {title}: CONSISTENCY & SPEED
         </h1>
 
-        {/* Instructions summary */}
+        {/* Instructions summary - different text for music vs other tests */}
         <p style={{ 
           textAlign: "center", 
           maxWidth: "850px", 
@@ -54,9 +70,19 @@ export default function TestLayout({
           fontSize: "0.9375rem", 
           lineHeight: "1.6" 
         }}>
-          You'll assign a color to each <strong>{testType}</strong>. <strong>Click and hold</strong> the mouse on the wheel and <strong>drag</strong> to preview and adjust a color.
-          To record a choice, <strong>click to lock</strong> it — the small circle turns <span style={{ color: "#dc2626", fontWeight: "bold" }}>red</span> when locked — and click again to unlock if you need to change it.
-          Press <strong>Next</strong> to save each choice. For best results, use a laptop/desktop and turn off blue-light filters.
+          {testType === 'music' ? (
+            <>
+              You'll assign a color to each <strong>musical sound</strong>. <strong>Press the play button</strong> to hear each sound, then <strong>click and hold</strong> the mouse on the wheel and <strong>drag</strong> to preview and adjust a color.
+              To record a choice, <strong>click to lock</strong> it — the small circle turns <span style={{ color: "#dc2626", fontWeight: "bold" }}>red</span> when locked — and click again to unlock if you need to change it.
+              Press <strong>Next</strong> to save each choice. For best results, use a laptop/desktop with audio enabled.
+            </>
+          ) : (
+            <>
+              You'll assign a color to each <strong>{testType}</strong>. <strong>Click and hold</strong> the mouse on the wheel and <strong>drag</strong> to preview and adjust a color.
+              To record a choice, <strong>click to lock</strong> it — the small circle turns <span style={{ color: "#dc2626", fontWeight: "bold" }}>red</span> when locked — and click again to unlock if you need to change it.
+              Press <strong>Next</strong> to save each choice. For best results, use a laptop/desktop and turn off blue-light filters.
+            </>
+          )}
         </p>
 
         {/* Test phase and progress indicators */}
@@ -86,10 +112,11 @@ export default function TestLayout({
           alignItems: "start", 
           maxWidth: "1400px" 
         }}>
-          {/* Left: Instructions */}
+          
+          {/* Left column: Instructions */}
           <TestInstructions testType={testType} />
 
-          {/* Center: Color picker */}
+          {/* Center column: Color picker wheel */}
           <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
             <ColorWheel 
               width={500} 
@@ -110,7 +137,7 @@ export default function TestLayout({
             </p>
           </div>
 
-          {/* Right: Stimulus, preview, and action button */}
+          {/* Right column: Stimulus, preview, and action button */}
           <div style={{ 
             display: "flex", 
             flexDirection: "column", 
@@ -118,29 +145,38 @@ export default function TestLayout({
             gap: "1.5rem", 
             paddingLeft: "1rem" 
           }}>
-            <StimulusDisplay 
-              stimulus={stimulus}
-              testType={testType}
-              getFontSize={getFontSize}
-            />
+            {/* Conditionally render MusicPlayer for music tests, StimulusDisplay for others */}
+            {testType === 'music' ? (
+              <MusicPlayer 
+                stimulus={current.stimulus} 
+                onPlayingChange={setIsMusicPlaying}
+              />
+            ) : (
+              <StimulusDisplay 
+                stimulus={stimulus}
+                testType={testType}
+                getFontSize={getFontSize}
+              />
+            )}
 
+            {/* Color preview box with lock toggle */}
             <ColorPreviewLock 
               selected={selected}
               locked={locked}
               onToggle={onToggleLock}
             />
 
-            {/* Next button - disabled until color is locked */}
+            {/* Next button - disabled until color is locked AND music is not playing */}
             <button
               onClick={onNext}
-              disabled={!locked}
+              disabled={!locked || isMusicPlaying}
               style={{
                 marginTop: "1rem",
                 padding: "0.625rem 2rem",
                 border: "none",
                 borderRadius: "4px",
-                cursor: locked ? "pointer" : "not-allowed",
-                backgroundColor: locked ? "#000" : "#d1d5db",
+                cursor: (locked && !isMusicPlaying) ? "pointer" : "not-allowed",
+                backgroundColor: (locked && !isMusicPlaying) ? "#000" : "#d1d5db",
                 color: "white",
                 fontWeight: "600",
                 fontSize: "0.875rem",
-- 
2.46.1

